@inject IJSRuntime JSRuntime
@inject HttpClient Http

<canvas id="waveform-@_waveformId" width="1600" height="194" class="song-height waveform"></canvas>

@code {
    [Parameter] public string? WaveformUrl { get; set; }
    
    Guid? _waveformId = Guid.NewGuid();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await DrawWaveform();
        }
    }
    
    // Draw waveform
    private async Task DrawWaveform()
    {
        // Get the canvas element
        var canvas = await JSRuntime.InvokeAsync<IJSObjectReference>("document.getElementById", $"waveform-{_waveformId}");
        
        // Fetch the waveform JSON
        var waveformJson = await Http.GetFromJsonAsync<object>(WaveformUrl);
        
        // Draw the waveform
        await JSRuntime.InvokeVoidAsync("drawWaveform", waveformJson, canvas);
    }
}

